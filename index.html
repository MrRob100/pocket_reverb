<h1>POCKET REVERB 2</h1>

<div id="buttons">
    <button class="record">Record</button>
    <button class="stop">Stop</button>
</div>

<script>
    const record = document.querySelector('.record');



    if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
        console.log('getUserMedia supported.');
        navigator.mediaDevices.getUserMedia (
            // constraints - only audio needed for this app
            {
                audio: true
            })

            // Success callback
            .then(function(stream) {
                const mediaRecorder = new MediaRecorder(stream);
                record.onclick = function() {

                    const AudioContext = window.AudioContext || window.webkitAudioContext;
                    const audioCtx = new AudioContext();

                    mediaRecorder.start();
                    console.log(mediaRecorder.state);
                    console.log("recorder started");
                    record.style.background = "red";
                    record.style.color = "black";
                }

                let chunks = [];

                mediaRecorder.ondataavailable = function(e) {
                    chunks.push(e.data);
                    //instead of pushing it to data, play it!
                    const source = audioCtx.createBufferSource();
                    source.buffer = context.createBuffer(e.data, false);
                    source.start();

                }
            })

            // Error callback
            .catch(function(err) {
                    console.log('The following getUserMedia error occurred: ' + err);
                }
            );
    } else {
        console.log('getUserMedia not supported on your browser!');
    }
</script>